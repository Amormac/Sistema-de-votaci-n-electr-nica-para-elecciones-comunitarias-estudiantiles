{% extends 'base.html' %}

{% block content %}
<div class="page-header">
    <h1>Gesti√≥n de Candidatos</h1>
</div>

<div class="card">
    <h3>Seleccionar Elecci√≥n</h3>
    <form method="get">
        <label>Elecci√≥n (solo pendientes):</label>
        <select name="election_id" onchange="this.form.submit()">
            <option value="">-- Seleccionar Elecci√≥n --</option>
            {% for e in elecciones %}
            <option value="{{ e.id }}" {% if selected_election==e.id %}selected{% endif %}>{{ e.titulo }}</option>
            {% endfor %}
        </select>
    </form>
</div>

{% if selected_election %}
{% if not cargos %}
<div class="alert alert-warning">Esta elecci√≥n no tiene cargos asignados.
    <a href="{{ url_for('admin.eleccion_cargos', id=selected_election) }}">Asignar cargos primero</a>.
</div>
{% else %}
<div class="grid-2">
    <div class="card">
        <h3>Nuevo Candidato</h3>
        <form method="post">
            <input type="hidden" name="action" value="create">
            <input type="hidden" name="election_id" value="{{ selected_election }}">

            <label>Cargo</label>
            <select name="cargo_id" required>
                {% for c in cargos %}
                <option value="{{ c.id }}">{{ c.nombre }}</option>
                {% endfor %}
            </select>

            <label>Nombres completos</label>
            <input type="text" name="nombres" required placeholder="Nombre del candidato">

            <label>Partido / Lista</label>
            <input type="text" name="partido" required placeholder="Nombre del partido o lista">

            <button type="submit" class="btn btn-success">Agregar Candidato</button>
        </form>
    </div>

    <div class="card">
        <h3>Candidatos Registrados</h3>
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>Cargo</th>
                        <th>Nombre</th>
                        <th>Partido</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for cand in candidatos %}
                    <tr>
                        <td><span class="badge badge-neutral">{{ cand.cargo_nombre }}</span></td>
                        <td><strong>{{ cand.nombres }}</strong></td>
                        <td>{{ cand.partido }}</td>
                        <td>
                            <div class="btn-group">
                                <form method="post" class="inline-form"
                                    onsubmit="return confirm('¬øEliminar este candidato?');">
                                    <input type="hidden" name="action" value="delete">
                                    <input type="hidden" name="candidato_id" value="{{ cand.id }}">
                                    <input type="hidden" name="election_id" value="{{ selected_election }}">
                                    <button class="btn btn-sm btn-danger btn-icon" title="Eliminar">üóëÔ∏è</button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="4" class="text-center text-muted">No hay candidatos registrados para esta elecci√≥n
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endif %}
{% endif %}
{% endblock %}